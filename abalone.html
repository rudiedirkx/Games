<!doctype html>
<html lang="en">

<head>
	<title>Abalone</title>
	<meta charset="UTF-8" />
	<script>
		WebSocket.prototype.on = WebSocket.prototype.addEventListener;
	</script>
</head>

<body>


<pre id="log"></pre>

<form onsubmit="socket.send(JSON.stringify({cmd: 'eval', data: this.msg.value})); this.msg.value = ''; return false;">
	<p>Eval: <input name="msg" value="inspect(games)" autofocus size="80" /></p>
</form>

<script>
function _msg(msg, p) {
	document.getElementById('log').appendChild(p = document.createElement('p'));
	p.textContent = msg;
}
function _log() {
	return console.log.apply(console, arguments);
}

var url = "ws://" + location.host + ":8083",
	protocol = 'abalone';

_log('initializing socket...');
socket = new WebSocket(url, protocol);

socket.on("open", function(e, name) {
	_log('on open');
});

socket.on("message", function(e) {
	try {
		var msg = JSON.parse(e.data);
		_log('message', e, msg);
		if ( msg.action ) {
			_msg('=> ' + msg.action);
		}
	}
	catch (ex) {
		_msg(e.data);
	}
});

socket.on("error", function(e) {
	_log('on error', e);
});

socket.on("close", function(e) {
	_log('on close', e);
});
</script>


</body>

</html>
